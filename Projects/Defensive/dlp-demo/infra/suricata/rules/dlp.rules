# DLP Suricata Rules - Lab Use Only
# Never deploy to production without testing

# Large HTTP POST to unknown domains
alert http any any -> any any ( \
    msg:"DLP: Large HTTP POST to unknown domain"; \
    flow:established,to_server; \
    http.method; content:"POST"; \
    http.host; !content:"google.com"; !content:"microsoft.com"; !content:"apple.com"; \
    http.request_body; depth:1000000; \
    threshold: type limit, track by_src, count 1, seconds 60; \
    classtype:policy-violation; \
    sid:1000001; rev:1;)

# FTP file upload
alert ftp any any -> any any ( \
    msg:"DLP: FTP file upload detected"; \
    flow:established,to_server; \
    ftp.command; content:"STOR"; \
    classtype:policy-violation; \
    sid:1000002; rev:1;)

# SMTP with attachment to external domain
alert smtp any any -> any any ( \
    msg:"DLP: SMTP with attachment to external domain"; \
    flow:established,to_server; \
    smtp.command; content:"MAIL FROM"; \
    content:"@"; pcre:"/MAIL FROM:[^@]+@(?!example.com|company.com)/"; \
    file_data; content:"Content-Disposition"; content:"attachment"; \
    classtype:policy-violation; \
    sid:1000003; rev:1;)

# DNS TXT record query (potential tunneling)
alert dns any any -> any any ( \
    msg:"DLP: DNS TXT record query - potential tunneling"; \
    dns.query; class:IN; type:TXT; \
    threshold: type threshold, track by_src, count 10, seconds 60; \
    classtype:attempted-dos; \
    sid:1000004; rev:1;)

# Long DNS query (potential tunneling)
alert dns any any -> any any ( \
    msg:"DLP: Long DNS query - potential tunneling"; \
    dns.query; length:>100; \
    classtype:attempted-recon; \
    sid:1000005; rev:1;)

# Suspicious port activity
alert tcp any any -> any [21,25,587,4444,8080,8443] ( \
    msg:"DLP: Connection to suspicious port"; \
    flow:established,to_server; \
    classtype:suspicious-filename-detect; \
    sid:1000006; rev:1;)

# HTTP User Agent indicative of scripting
alert http any any -> any any ( \
    msg:"DLP: Suspicious HTTP User Agent"; \
    flow:established,to_server; \
    http.user_agent; content:"curl"; \
    http.user_agent; content:"wget"; \
    http.user_agent; content:"python"; \
    classtype:bad-unknown; \
    sid:1000007; rev:1;)

# Large outbound transfer
alert tcp any any -> any any ( \
    msg:"DLP: Large outbound data transfer"; \
    flow:established,to_server; \
    bytes:>10000000; \
    threshold: type limit, track by_src, count 1, seconds 60; \
    classtype:policy-violation; \
    sid:1000008; rev:1;)
