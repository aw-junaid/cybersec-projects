#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

#define MAX_VULNERABILITIES 1000
#define MAX_STRING_LENGTH 256

typedef enum {
    STATUS_NEW,
    STATUS_IN_PROGRESS,
    STATUS_RESOLVED,
    STATUS_FALSE_POSITIVE,
    STATUS_RISK_ACCEPTED
} VulnerabilityStatus;

typedef enum {
    SEVERITY_CRITICAL,
    SEVERITY_HIGH,
    SEVERITY_MEDIUM,
    SEVERITY_LOW,
    SEVERITY_INFO
} SeverityLevel;

typedef struct {
    char id[16];
    char title[MAX_STRING_LENGTH];
    char description[MAX_STRING_LENGTH];
    SeverityLevel severity;
    VulnerabilityStatus status;
    char asset[MAX_STRING_LENGTH];
    char discovered_date[11]; // YYYY-MM-DD
    char due_date[11];
    char assigned_to[MAX_STRING_LENGTH];
    float cvss_score;
    char proof[MAX_STRING_LENGTH];
    char remediation[MAX_STRING_LENGTH];
    char last_updated[11];
} Vulnerability;

typedef struct {
    Vulnerability vulnerabilities[MAX_VULNERABILITIES];
    int count;
    char data_file[MAX_STRING_LENGTH];
} VulnerabilityDashboard;

// Function prototypes
void initialize_dashboard(VulnerabilityDashboard *dashboard, const char *data_file);
void load_data(VulnerabilityDashboard *dashboard);
void save_data(VulnerabilityDashboard *dashboard);
void add_vulnerability(VulnerabilityDashboard *dashboard);
void update_status(VulnerabilityDashboard *dashboard);
void display_dashboard(VulnerabilityDashboard *dashboard);
void display_statistics(VulnerabilityDashboard *dashboard);
void display_vulnerabilities(VulnerabilityDashboard *dashboard);
const char* status_to_string(VulnerabilityStatus status);
const char* severity_to_string(SeverityLevel severity);
VulnerabilityStatus string_to_status(const char *status_str);
SeverityLevel string_to_severity(const char *severity_str);
void get_current_date(char *date_string);

void initialize_dashboard(VulnerabilityDashboard *dashboard, const char *data_file) {
    strcpy(dashboard->data_file, data_file);
    dashboard->count = 0;
    load_data(dashboard);
}

void load_data(VulnerabilityDashboard *dashboard) {
    FILE *file = fopen(dashboard->data_file, "r");
    if (!file) {
        printf("No existing data file found. Starting with empty dashboard.\n");
        return;
    }
    
    char line[1024];
    while (fgets(line, sizeof(line), file) && dashboard->count < MAX_VULNERABILITIES) {
        Vulnerability *vuln = &dashboard->vulnerabilities[dashboard->count];
        
        sscanf(line, "%15[^,],%255[^,],%255[^,],%d,%d,%255[^,],%10[^,],%10[^,],%255[^,],%f,%255[^,],%255[^,],%10s",
               vuln->id, vuln->title, vuln->description, 
               (int*)&vuln->severity, (int*)&vuln->status,
               vuln->asset, vuln->discovered_date, vuln->due_date,
               vuln->assigned_to, &vuln->cvss_score,
               vuln->proof, vuln->remediation, vuln->last_updated);
        
        dashboard->count++;
    }
    
    fclose(file);
    printf("Loaded %d vulnerabilities from %s\n", dashboard->count, dashboard->data_file);
}

void save_data(VulnerabilityDashboard *dashboard) {
    FILE *file = fopen(dashboard->data_file, "w");
    if (!file) {
        printf("Error: Could not open file for writing.\n");
        return;
    }
    
    for (int i = 0; i < dashboard->count; i++) {
        Vulnerability *vuln = &dashboard->vulnerabilities[i];
        fprintf(file, "%s,%s,%s,%d,%d,%s,%s,%s,%s,%.1f,%s,%s,%s\n",
                vuln->id, vuln->title, vuln->description,
                vuln->severity, vuln->status,
                vuln->asset, vuln->discovered_date, vuln->due_date,
                vuln->assigned_to, vuln->cvss_score,
                vuln->proof, vuln->remediation, vuln->last_updated);
    }
    
    fclose(file);
    printf("Data saved to %s\n", dashboard->data_file);
}

void add_vulnerability(VulnerabilityDashboard *dashboard) {
    if (dashboard->count >= MAX_VULNERABILITIES) {
        printf("Error: Maximum number of vulnerabilities reached.\n");
        return;
    }
    
    Vulnerability *vuln = &dashboard->vulnerabilities[dashboard->count];
    
    // Generate ID
    snprintf(vuln->id, sizeof(vuln->id), "VULN-%04d", dashboard->count + 1);
    
    printf("Enter vulnerability title: ");
    fgets(vuln->title, sizeof(vuln->title), stdin);
    vuln->title[strcspn(vuln->title, "\n")] = 0;
    
    printf("Enter description: ");
    fgets(vuln->description, sizeof(vuln->description), stdin);
    vuln->description[strcspn(vuln->description, "\n")] = 0;
    
    printf("Enter severity (0=Critical,1=High,2=Medium,3=Low,4=Info): ");
    int severity;
    scanf("%d", &severity);
    getchar(); // Consume newline
    vuln->severity = (SeverityLevel)severity;
    
    vuln->status = STATUS_NEW;
    
    printf("Enter affected asset: ");
    fgets(vuln->asset, sizeof(vuln->asset), stdin);
    vuln->asset[strcspn(vuln->asset, "\n")] = 0;
    
    get_current_date(vuln->discovered_date);
    strcpy(vuln->due_date, "");
    
    printf("Enter assigned to: ");
    fgets(vuln->assigned_to, sizeof(vuln->assigned_to), stdin);
    vuln->assigned_to[strcspn(vuln->assigned_to, "\n")] = 0;
    
    printf("Enter CVSS score: ");
    scanf("%f", &vuln->cvss_score);
    getchar();
    
    printf("Enter proof/evidence: ");
    fgets(vuln->proof, sizeof(vuln->proof), stdin);
    vuln->proof[strcspn(vuln->proof, "\n")] = 0;
    
    printf("Enter remediation: ");
    fgets(vuln->remediation, sizeof(vuln->remediation), stdin);
    vuln->remediation[strcspn(vuln->remediation, "\n")] = 0;
    
    strcpy(vuln->last_updated, vuln->discovered_date);
    
    dashboard->count++;
    save_data(dashboard);
    printf("Vulnerability added with ID: %s\n", vuln->id);
}

void update_status(VulnerabilityDashboard *dashboard) {
    char vuln_id[16];
    printf("Enter Vulnerability ID: ");
    fgets(vuln_id, sizeof(vuln_id), stdin);
    vuln_id[strcspn(vuln_id, "\n")] = 0;
    
    int found = 0;
    for (int i = 0; i < dashboard->count; i++) {
        if (strcmp(dashboard->vulnerabilities[i].id, vuln_id) == 0) {
            printf("Current status: %s\n", status_to_string(dashboard->vulnerabilities[i].status));
            printf("Enter new status (0=New,1=In Progress,2=Resolved,3=False Positive,4=Risk Accepted): ");
            int new_status;
            scanf("%d", &new_status);
            getchar();
            
            dashboard->vulnerabilities[i].status = (VulnerabilityStatus)new_status;
            get_current_date(dashboard->vulnerabilities[i].last_updated);
            
            save_data(dashboard);
            printf("Status updated successfully!\n");
            found = 1;
            break;
        }
    }
    
    if (!found) {
        printf("Vulnerability not found!\n");
    }
}

void display_dashboard(VulnerabilityDashboard *dashboard) {
    printf("\n");
    printf("=======================================\n");
    printf("    VULNERABILITY MANAGEMENT DASHBOARD\n");
    printf("=======================================\n");
    printf("Total Vulnerabilities: %d\n\n", dashboard->count);
    
    // Count by status
    int status_count[5] = {0};
    int severity_count[5] = {0};
    
    for (int i = 0; i < dashboard->count; i++) {
        status_count[dashboard->vulnerabilities[i].status]++;
        severity_count[dashboard->vulnerabilities[i].severity]++;
    }
    
    printf("STATUS DISTRIBUTION:\n");
    for (int i = 0; i < 5; i++) {
        printf("  %s: %d\n", status_to_string(i), status_count[i]);
    }
    
    printf("\nSEVERITY DISTRIBUTION:\n");
    for (int i = 0; i < 5; i++) {
        printf("  %s: %d\n", severity_to_string(i), severity_count[i]);
    }
    
    printf("\nRECENT VULNERABILITIES:\n");
    printf("ID        Title                     Severity    Status          Assigned To\n");
    printf("--------------------------------------------------------------------------\n");
    
    int start = (dashboard->count > 10) ? dashboard->count - 10 : 0;
    for (int i = start; i < dashboard->count; i++) {
        Vulnerability *v = &dashboard->vulnerabilities[i];
        printf("%-9s %-25s %-11s %-15s %-15s\n", 
               v->id, v->title, severity_to_string(v->severity), 
               status_to_string(v->status), v->assigned_to);
    }
}

void display_vulnerabilities(VulnerabilityDashboard *dashboard) {
    printf("\nALL VULNERABILITIES:\n");
    printf("================================================================================\n");
    
    for (int i = 0; i < dashboard->count; i++) {
        Vulnerability *v = &dashboard->vulnerabilities[i];
        printf("ID: %s\n", v->id);
        printf("Title: %s\n", v->title);
        printf("Severity: %s (CVSS: %.1f)\n", severity_to_string(v->severity), v->cvss_score);
        printf("Status: %s\n", status_to_string(v->status));
        printf("Asset: %s\n", v->asset);
        printf("Discovered: %s | Last Updated: %s\n", v->discovered_date, v->last_updated);
        printf("Assigned To: %s\n", v->assigned_to);
        printf("Proof: %s\n", v->proof);
        printf("Remediation: %s\n", v->remediation);
        printf("--------------------------------------------------------------------------------\n");
    }
}

const char* status_to_string(VulnerabilityStatus status) {
    switch (status) {
        case STATUS_NEW: return "New";
        case STATUS_IN_PROGRESS: return "In Progress";
        case STATUS_RESOLVED: return "Resolved";
        case STATUS_FALSE_POSITIVE: return "False Positive";
        case STATUS_RISK_ACCEPTED: return "Risk Accepted";
        default: return "Unknown";
    }
}

const char* severity_to_string(SeverityLevel severity) {
    switch (severity) {
        case SEVERITY_CRITICAL: return "Critical";
        case SEVERITY_HIGH: return "High";
        case SEVERITY_MEDIUM: return "Medium";
        case SEVERITY_LOW: return "Low";
        case SEVERITY_INFO: return "Info";
        default: return "Unknown";
    }
}

void get_current_date(char *date_string) {
    time_t t = time(NULL);
    struct tm *tm = localtime(&t);
    strftime(date_string, 11, "%Y-%m-%d", tm);
}

int main() {
    VulnerabilityDashboard dashboard;
    initialize_dashboard(&dashboard, "vulnerabilities.csv");
    
    int choice;
    
    do {
        display_dashboard(&dashboard);
        
        printf("\nACTIONS:\n");
        printf("1. Add New Vulnerability\n");
        printf("2. Update Vulnerability Status\n");
        printf("3. View All Vulnerabilities\n");
        printf("4. Exit\n");
        printf("Select action (1-4): ");
        
        scanf("%d", &choice);
        getchar(); // Consume newline
        
        switch (choice) {
            case 1:
                add_vulnerability(&dashboard);
                break;
            case 2:
                update_status(&dashboard);
                break;
            case 3:
                display_vulnerabilities(&dashboard);
                break;
            case 4:
                printf("Goodbye!\n");
                break;
            default:
                printf("Invalid choice!\n");
        }
        
        printf("\nPress Enter to continue...");
        getchar();
        
    } while (choice != 4);
    
    return 0;
}vulnerability_dashboard.c
